<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ëª…í•¨ ë³´ê¸°</title>

    <!-- ë¶„ë¦¬ëœ CSS -->
    <link rel="stylesheet" href="card.css">
</head>
<body>
<div class="page">
    <!-- ëª…í•¨ì´ í‘œì‹œë  ì˜ì—­ -->
    <div id="cardContainer"></div>

    <!-- ì•„ë˜ ë²„íŠ¼ ì˜ì—­ -->
    <div class="actions" id="actions" style="display:none;">
        <button class="btn primary" id="btnDownloadQr">QR ë‹¤ìš´ë¡œë“œ</button>
        <button class="btn" id="btnSaveToApp">ì•±ì— ë“±ë¡</button>
        <button class="btn" id="btnDownloadApp">ì•± ë‹¤ìš´ë¡œë“œ</button>
        <p class="helper-text">â€» ì•±ì— ë“±ë¡ / ì•± ë‹¤ìš´ë¡œë“œëŠ” ë‚˜ì¤‘ì— ì—°ë™ ì˜ˆì •ì…ë‹ˆë‹¤.</p>
    </div>
</div>

<!-- QRCode.js: QR ë‹¤ìš´ë¡œë“œìš© -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

<script>
    // 1ï¸âƒ£ í…ŒìŠ¤íŠ¸ìš© ëª…í•¨ ë°ì´í„° (ì•„ì´ë””ë³„ë¡œ ëª…í•¨ ì •ë³´)
    const cards = {
        "choan1130": {
            name: "ì¡°ì•ˆì •",
            job: "ì†Œí”„íŠ¸ì›¨ì–´í•™ë¶€ 24í•™ë²ˆ",
            phone: "010-1234-5678",
            email: "joanjeong@example.com",
            company: "Someday",
            website: "https://example.com"
        },
        "USER_987654": {
            name: "í™ê¸¸ë™",
            job: "ë°±ì—”ë“œ ê°œë°œì",
            phone: "010-9999-8888",
            email: "hong@example.com",
            company: "Dev Team",
            website: "https://dev.example.com"
        }
        // ğŸ‘‰ ì—¬ê¸° ê³„ì† ì¶”ê°€í•˜ë©´ ë¨
    };

    // 2ï¸âƒ£ URLì—ì„œ id ì¿¼ë¦¬ ì½ê¸°
    const params = new URLSearchParams(window.location.search);
    let id = params.get("id");  // â† ìˆ˜ì •ë¨! (const â†’ let)

    if (!id) id = "choan1130";  // ê¸°ë³¸ ì•„ì´ë””

    const cardContainer = document.getElementById("cardContainer");
    const actions = document.getElementById("actions");

    if (!id || !cards[id]) {
        cardContainer.innerHTML = `
            <div class="error">
                ì´ ëª…í•¨ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.<br>
                (id: ${id ? id : "ì—†ìŒ"})
            </div>
        `;
    } else {
        // 3ï¸âƒ£ ëª…í•¨ ì •ë³´ë¥¼ HTMLë¡œ ë Œë”ë§
        const data = cards[id];
        cardContainer.innerHTML = `
            <div class="card">
                <div class="name">${data.name}</div>
                <div class="job">${data.job}</div>
                <div class="info-line"><span class="label">ì†Œì†</span> ${data.company || "-"}</div>
                <div class="info-line"><span class="label">ì „í™”</span> ${data.phone || "-"}</div>
                <div class="info-line"><span class="label">ì´ë©”ì¼</span> ${data.email || "-"}</div>
                <div class="info-line"><span class="label">ì›¹</span> ${data.website || "-"}</div>
            </div>
        `;
        actions.style.display = "flex";
    }

    // 4ï¸âƒ£ QR ë‹¤ìš´ë¡œë“œ: í˜„ì¬ í˜ì´ì§€ ì£¼ì†Œë¡œ QR ë§Œë“¤ì–´ì„œ png ë‹¤ìš´ë¡œë“œ
    const btnDownloadQr = document.getElementById("btnDownloadQr");
    const btnSaveToApp = document.getElementById("btnSaveToApp");
    const btnDownloadApp = document.getElementById("btnDownloadApp");

    if (btnDownloadQr) {
        btnDownloadQr.addEventListener("click", function () {
            const temp = document.createElement("div");
            temp.style.position = "fixed";
            temp.style.left = "-9999px";
            document.body.appendChild(temp);

            const qr = new QRCode(temp, {
                text: window.location.href,
                width: 512,
                height: 512
            });

            setTimeout(function () {
                const img = temp.querySelector("img") || temp.querySelector("canvas");
                if (!img) {
                    alert("QR ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
                    document.body.removeChild(temp);
                    return;
                }

                let dataUrl;
                if (img.tagName.toLowerCase() === "img") {
                    dataUrl = img.src;
                } else {
                    dataUrl = img.toDataURL("image/png");
                }

                const link = document.createElement("a");
                link.href = dataUrl;
                link.download = "my_card_qr.png";
                link.click();

                document.body.removeChild(temp);
            }, 300);
        });
    }

    // 5ï¸âƒ£ ì•±ì— ë“±ë¡ / ì•± ë‹¤ìš´ë¡œë“œ (í˜„ì¬ëŠ” ì•ˆë‚´ë§Œ)
    if (btnSaveToApp) {
        btnSaveToApp.addEventListener("click", function () {
            alert("ì•± ì—°ë™ì€ ì¶”í›„ì— ì¶”ê°€ë  ì˜ˆì •ì…ë‹ˆë‹¤.");
        });
    }

    if (btnDownloadApp) {
        btnDownloadApp.addEventListener("click", function () {
            alert("ì•± ë‹¤ìš´ë¡œë“œ ë§í¬ëŠ” ì¶”í›„ì— ì—°ê²°ë  ì˜ˆì •ì…ë‹ˆë‹¤.");
        });
    }
</script>
</body>
</html>
